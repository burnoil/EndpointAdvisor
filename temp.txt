// 1) Create LLNotify install folder
waithidden mkdir "C:\Program Files\LLNotify"

// 2) Copy application files
copy __Download\LLNOTIFY.ps1      "C:\Program Files\LLNotify\LLNOTIFY.ps1"
copy __Download\LL_LOGO.ico       "C:\Program Files\LLNotify\LL_LOGO.ico"
copy __Download\LL_LOGO_MSG.ico   "C:\Program Files\LLNotify\LL_LOGO_MSG.ico"

// 3) Write a shortcut-creation script to a temp file
delete __Download\CreateShortcut.ps1
createfile until __EOF__
$WshShell = New-Object -ComObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut([Environment]::GetFolderPath("Startup") + "\LLNotify.lnk")
$Shortcut.TargetPath = "$env:SystemRoot\System32\WindowsPowerShell\v1.0\powershell.exe"
$Shortcut.Arguments = "-WindowStyle Hidden -NoProfile -ExecutionPolicy Bypass -File `"C:\Program Files\LLNotify\LLNOTIFY.ps1`""
$Shortcut.IconLocation = "C:\Program Files\LLNotify\LL_LOGO.ico"
$Shortcut.Save()
__EOF__

move __createfile __Download\CreateShortcut.ps1

// 4) Run that PowerShell shortcut creation script as current user
override runas=currentuser
run powershell.exe -NoProfile -ExecutionPolicy Bypass -File "__Download\CreateShortcut.ps1"

// 5) Launch LLNOTIFY.ps1 now as current user
override runas=currentuser
run powershell.exe -NoProfile -WindowStyle Hidden -ExecutionPolicy Bypass -File "C:\Program Files\LLNotify\LLNOTIFY.ps1"
